% ----------------------------------------------- %
% --- File: IEEE_paper.tex  --------------------- %
% --- Authors: Nick, Jed, Zach, K-Dink   -------- %
% --- Due Date: 11:59PM, Sunday, January 6th ---- %
% ----------------------------------------------- %

% IEEE Special Document Class
\documentclass[twocolumn,letterpaper]{IEEEAerospace2012}

% Other packages
\usepackage{times, rawfonts, geometry}
\usepackage[pdftex,final]{graphicx}
\usepackage{amsmath,amssymb}
\usepackage{float}

% New commands
\newcommand{\ignore}[1]{}  % {} empty inside = %% comment

% Scientific notation:
\providecommand{\e}[1]{\ensuremath{\times 10^{#1}}}

% General
\newcommand{\parens} [1] {\left(  #1  \right)}
\newcommand{\brackets} [1] {\left[ #1 \right]}
\newcommand{\rootdir}{./Figures/}

% Array
\newcommand{\arrayp}[2]{\parens{ \begin{array}{#1}  #2 \end{array} } }
\newcommand{\arrayb}[2]{\brackets{ \begin{array}{#1}  #2 \end{array} } }

% Multiletter Variables
\newcommand{\RN}{\mathit{RN}}
\newcommand{\DC}{\mathit{DC}}
\newcommand{\SNR}{\mathit{SNR}}
\newcommand{\BC}{\mathit{BC}}
\newcommand{\sub}[1]{\text{#1}} % subscript

% -------------------------------------------------------------------------- $
% -------------------------------- DOCUMENT -------------------------------- $
% -------------------------------------------------------------------------- $
\begin{document}

\title{DayStar: Modeling and Test Results of a Balloon-Borne Daytime Star Tracker}

\author{%
    Nicholas A. Truesdale\\
    Kevin J. Dinkel\\
    Aerospace Engineering Sciences\\
    University of Colorado\\
    Boulder, CO 80309\\
    nicholas.truesdale@colorado.edu\\
    kevin.dinkel@colorado.edu\\
    \and
    Zach J. B. Dischner\\
    Jed H. Diller \\
    Aerospace Engineering Sciences\\
    University of Colorado\\
    Boulder, CO 80309\\
    zach.dischner@colorado.edu\\
    jedediah.diller@colorado.edu
    \and
    Eliot F. Young\\
    Space Studies Department\\
    Southwest Research Institute\\
    Boulder, CO 80302\\
    efy@boulder.swri.edu
    \thanks{\footnotesize 978-1-4577-0557-1/12/$\$26.00$ \copyright2012 IEEE.}
    \thanks{$^1$ IEEEAC Paper \#2767, Version 1.0, Updated 29/10/2012.}
}

\thispagestyle{plain}
\pagestyle{plain}

\maketitle

\begin{abstract}
    High altitude balloons are capable of supporting astronomical observations with virtually no image degradation due to atmospheric turbulence. To take advantage of this space-like seeing, a telescope must be pointed and stabilized with sub-arcsecond precision. This problem consists of two parts: providing an error signal, and using it to correct the pointing. This paper addresses error signal acquisition, specifically focusing on modeling and flight testing of the DayStar star tracker.

    DayStar is a star tracker designed under the University of Colorado Aerospace Capstone Program with support from Southwest Research Institute. It is intended to improve upon the pointing accuracy and daytime performance of the ST5000, a star tracker commonly used in NASA’s sounding rocket program. The ST5000 was shown to work on a balloon at night, but failed to acquire stars during daytime. DayStar remedies this issue by filtering light below 620 nm and by using a CMOS sensor with high red-performance and resolution. This attenuates most of the sky background, which, combined with custom star identification algorithms, allows stars be seen during the day.

    To validate modeling and demonstrate daytime star acquisition, a DayStar prototype flew on a high altitude balloon in September, 2012. The filtered camera typically saw four or more stars during daytime, proving the ability to operate diurnally. Additional analysis evaluates DayStar’s ability to centroid stars, match stars between frames, and use a series of images to track its attitude. This links the precision of star centroiding algorithms with the pointing acuity for both day and night conditions. These findings will be used to validate the performance model and examine DayStar as a potential star tracker for high altitude balloon observatories.
\end{abstract}

\tableofcontents

%-------------------------------------------------------------------------------------------------------
\section{Introduction}
NASA's Scientific Balloon Program flies large payloads (up to 8000 lb) each and every year. These missions can last anywhere from a few hours to several weeks, and offer scientific research at $120,000$ ft, above $99.5\%$ of the Earth's atmosphere \cite{young2012}. This is especially advantageous for telescopic observing, providing conditions almost entirely devoid of image degradation due to atmospheric turbulence. The development of a balloon platform that can image in visible wavelengths with $0.1''$ resolution is of widespread importance. Ground-based system such as Subaru often look only in infrared wavelengths longer than $1 \mu$m due to the unacceptable quality of visible images. Short of expensive orbital telescopes such as the Hubble Space Telescope (HST), balloon-borne systems are the only way to achieve diffraction limited performance in the visible regime. An inexpensive, 1-m telescope in the stratosphere will rival the performance of HST and outperform every ground-based telescope every night of
the year \cite{young2012}.

The potential for stratospheric 1-m and 2-m telescopes to operate at their diffraction limits can only be realized with pointing and tracking systems of comparable performance. The goal of this project is to improve tracking (attitude determination) on balloon platforms to levels capable of supporting these systems.

The current standard for balloon-based attitude determination is the University of Wisconsin's Star Tracker 5000 (ST5000). With roots in NASA's sounding rocket program, this instrument was test flown on a balloon on May 6, 2011 and performed at $0.24''$ and $0.53''$ ($1\sigma$) pitch and yaw accuracies during nighttime. Unfortunately, the ST5000 saturated 30 minutes before sunrise and was unable to provide an attitude signal during the day \cite{young2012}. The diffraction limit of a 1-m telescope is $0.125''$ at $5000 \AA{}$. In order to have attitude control at this level, an error signal must be provided that is at least as accurate. While the ST5000 is close, it is still a factor of 5 too coarse to be the sole optical reference \cite{young2012}.

To enable daytime operation and achieve better attitude knowledge, a star tracker needs to be designed with a longer focal length and finer plate scale than the ST5000. Two benefits emerge with these changes: the intensity level of the sky background relative to star flux drops and the centroiding of stars becomes more accurate. DayStar, a balloon-borne diurnal star tracker conceived by students from the University of Colorado, has not only been designed to take advantage of these modifications but has further improved daytime capabilities by using a red-sensitive sensor, long-pass filtering, and superior baffling. This paper will detail the modeling of DayStar's performance, describe key components of the DayStar system, and discuss results from DayStar's September 2012 test flight.

%-------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------------------------------
\section{Modeling}
The performance of DayStar depends on two factors: image quality and algorithm performance. The two are functionally independent, and must be linked by one or more parameters. The primary link is signal-to-noise ratio, $\SNR$, although the size of stars in the image is also important. The following sections describe how a threshold $\SNR$ and star size are determined by star centroiding algorithms, and how image quality analysis is used to support DayStar's design parameters and predict daytime performance.

%-------------------------------------------------------------------------------------------------------
\subsection{Algorithm Performance}
The accuracy to which DayStar can determine its attitude is a function of how many stars it can find at any given time and how well it centroids those stars. Turning a set of star vectors into an attitude measurement is accomplished using Davenport's q-method \cite{qmethod}, which finds a least squares solution for the rotation between two coordinate frames.

To discover how the q-method performs, a Monte Carlo simulation was conducted. A set of star coordinates was generated and subsequently perturbed using Gaussian random variables. The q-method was then used to calculate the rotation from the original frame to the perturbed frame. The number of stars in the field of view and the magnitude of the perturbations were varied to simulate different levels of star detection and centroiding ability. Figure \ref{fig:accuracy} shows the results of the simulation. The more stars that DayStar is able to locate, the better it can produce accurate attitude solutions.
\begin{figure}[H]
    \centering
    \includegraphics[width=3.3in]{\rootdir accuracy.eps}
    \caption{Attitude accuracy is a function of the centroid accuracy (colored lines) and the number of stars using in the q-method transformation}
    \label{fig:accuracy}
\end{figure}

DayStar locates stars in an image using a custom algorithm which first finds a robust estimation for the background intensity and variance, and then examines pixels above the background to decide if they are stars based on size, shape, and intensity. The performance of this algorithm was tested by generating synthetic star fields, as in Figure \ref{fig:starfield}, with known star locations and specified $\SNR$s. Because DayStar was designed to centroid star images that are slightly out of focus and taken over appreciable exposures, generated stars were approximated as normal distributions. Shot noise was added to each image as a Poisson distributed random variable.
\begin{figure}
    \centering
    \includegraphics[width=3.0in]{\rootdir starfield.eps}
    \caption{Simulated starfield with added shot noise.}
    \label{fig:starfield}
\end{figure}
The probability of detecting a star is a function of how long the array integrates the star's signal, which is the exposure time, and over how many pixels the star's signal is spread, which is termed \emph{blur}. Testing the star detection algorithm over a range of different exposure times and blurs, its behavior is characterized below.
\begin{figure}[H]
    \centering
    \includegraphics[width=3.3in]{\rootdir detectstars.eps}
    \caption{The target region represents the exposure time and blur where the star identification algorithm is most successful.}
    \label{fig:detectstars}
\end{figure}
From Figure \ref{fig:detectstars}, the daytime design-to exposure range was chosen to be 30-70 ms and the blur was chosen to be between $16$ ($4 \times 4$) and $36$ ($6 \times 6$) pixels. These values correspond to a specific signal to noise ratio depending on the magnitude of the star in question. This relationship, shown in Figure \ref{fig:snr}, also varies with blur and exposure time.
\begin{figure}
    \centering
    \includegraphics[width=3.3in]{\rootdir snr.eps}
    \caption{The signal to noise ratio of a star is a function of exposure time and the number of pixels over which it is subtended.}
    \label{fig:snr}
\end{figure}
For DayStar to successfully identify and centroid a star a minimum $\SNR$ of 6.0 was chosen as a design-to specification.

%-------------------------------------------------------------------------------------------------------
\subsection{Image Quality}
Given a minimum $\SNR$ and a star blur of 4 to 6 pixels square, the goal of the image modeling is to determine the number of stars visible during night and day. This requires identification of signal and noise sources; we assume that the sky background and stars generate Poisson shot noise, and also consider dark current $\DC$ and read noise $\RN$ from the image sensor. On a star-by-star basis, $\SNR$ is given by Equation \ref{eq:snr}, in which $F$ is the flux from the star or background in photons per second per pixel, $t$ is exposure time in seconds and $n$ is the number of square pixels that totally encompass the star as specified in Figure \ref{fig:detectstars}.
\begin{equation}
    \label{eq:snr}
    \SNR = \frac{F_{\sub{star}}t}{\sqrt{F_{\sub{star}} t + F_{\sub{sky}} n t + \DC n t + \RN^2 n }}
\end{equation}

\begin{figure}[H]
    \centering
    \includegraphics[width=3.0in]{\rootdir modtran_alt.eps}
    \caption{The sky background is found by interpolation for a 38km flight with 90 degree solar azimuth.}
    \label{fig:modtran}
\end{figure}
The dark current and read noise are properties of the sensor. The flux from the star and the background, however, must be modeled based on DayStar's environment and pointing. The background flux can be estimated from the MODTRAN \cite{young2012} model for sky brightness, as seen in Figure \ref{fig:modtran}. The unit of kilo-Rayleighs is equivalent to $\frac{10^{9}}{4\pi}$ photons/s/cm$^2$/steradian. Note that the flux in Figure \ref{fig:modtran} is parameterized by wavelength, which allows us to apply the effects of quantum efficiency and filtering. Also note that the background decreases sharply for longer wavelengths; this characteristic is exploited to achieve daytime performance using a longpass filter.

Estimating the flux from a star is a more involved process, which owes its complexity to the standard use of visual magnitude ($m_v$) as a measure of star brightness. In order to generalize magnitude to all wavelengths, the temperature of a star (which is also a common value in star catalogs) is used to calculate an empirically-determined correction \cite{bolometric}. This yields the bolometric magnitude via:
\begin{equation}
    \label{eq:bolometric}
    m_b = m_v + \BC (T)
\end{equation}
The bolometric magnitude is a logarithmic scale just like visual magnitude, so it can be used to compare a given star to a known source with magnitude $m_{b,0}$ and total flux $F_0$ (the Sun is a likely candidate). This yields the integrated flux from the star across all wavelengths:
\begin{equation}
    \label{eq:totalflux}
    F_{\sub{star, total}} = F_0 10^{0.4 \parens{m_{b,0} - m_{b,\sub{star}}}}
\end{equation}
Now, since the total flux is known, it can be used to scale the Planck blackbody curve for the star, which is a function again of the star's temperature:
\begin{equation}
    \label{eq:planck}
    I(\lambda, T) = \frac{2c}{\lambda^4 \brackets{\exp{\frac{hc}{\lambda k T}} - 1}}
\end{equation}
Once the blackbody curve is known, its area is normalized, at which point flux as a function of wavelength is simply:
\begin{equation}
    \label{eq:flux}
    F_{\sub{star}}(\lambda) = F_{\sub{star,total}}\frac{I(\lambda,T)}{\int_0^\infty I(\lambda,T) \, d\lambda}
\end{equation}

Now, the flux from the background and star are parameterized by wavelength. This allows us to incorporate the quantum efficiency of the optics and any optical filtering, whose attenuation of light is described by $Q(\lambda)$. At last, the flux seen by the camera from both sources is found by integrating over all wavelengths, though in practice this range is bounded by a longpass filter on one end and the camera QE on the other.
\begin{equation}
    \label{eq:totalfluxes}
    F = \int_{\lambda_1}^{\lambda_2} Q(\lambda) F(\lambda) \, d\lambda
\end{equation}

At the end of this process, the flux terms in Equation \ref{eq:snr} have been defined in terms of system and operational parameters. The background relies chiefly on altitude, while star flux is a function of visual magnitude and temperature. In addition, the units of flux have area and, in the case of the background, solid angle field of view in the denominator. This means the model also depends on the optics aperture size and total field of view.

\begin{figure*}
    \centering
    \includegraphics[width = 4.7in]{\rootdir sensitivity.jpg}
    \caption{The ideal longpass wavelength is between 600nm and 640nm. DayStar uses a 620nm filter.}
    \label{fig:longpass}
\end{figure*}

The final piece of the image quality model is to apply Equation \ref{eq:snr} to a variety of stars to determine which are visible to the star identification algorithms. This requires a knowledge of the stars DayStar is likely to see. One option is to construct a representative star field from past surveys; an old work by P.J Van Rhijn \cite{vanrhijn} is an example of one that categorizes stars by visual magnitude and temperature, and reports the density per steradian of each type of star. A more thorough method could use catalogs like Tycho-2 to simulate actual starfields. For the sake of simplicity, DayStar's performance is estimated using the first method.
\begin{figure}[H]
    \centering
    \includegraphics[width = 3.3in]{\rootdir galacticlatitude.jpg}
    \caption{Stars are distributed by stellar class, which corresponds directly to temperature \protect \cite{stellar}.}
    \label{fig:gl}
\end{figure}
Three representative starfields are used, bounded by the $0-20^\circ$, $20-40^\circ$, and $40-90^\circ$ galactic latitude ranges, respectively. Per DayStar's requirements, visual magnitudes 4-8 are considered, and the number of stars across all magnitudes and temperatures are calculated for a representative image. Figure \ref{fig:gl} shows how stars are distributed based on the three galactic latitude ranges.

Every combination of magnitude and temperature is evaluated for $\SNR$. The total flux is also checked against the well depth, and stars that saturate are discarded. For each star with an $\SNR$ greater than 6.0, the fractional number in an average image is summed to find the total number of visible stars. This translates to a total system accuracy via Figure \ref{fig:accuracy}.

%-------------------------------------------------------------------------------------------------------
\subsection{Performance Analysis}
The modeling processes defined in the previous sections have two applications. The first is system design; sensitivity plots for system parameters can be created by calculating the number of stars over a range. One example that was used in DayStar's design is shown in Figure \ref{fig:longpass}. In this case, the longpass filter wavelength was chosen to maximize accuracy across all exposure times.

After all of DayStar's parameters had been defined, the modeling was also used to estimate performance during both day and night. In Figure \ref{fig:numstars}, this is broken down by visual magnitude and totaled in the final column. The three daytime estimates correspond to different methods of interpreting tabulated data for star temperature. The nominal method is a linear interpolation between discrete temperatures, while the worst and best cases are bound assuming stepwise functions. The results show that DayStar should be able to see stars in both daytime and nighttime in quantities that satisfy accuracy requirements.
\begin{figure}
    \includegraphics[width = 3.3in]{\rootdir numstars.jpg}
    \caption{The total number of stars for the worst case galactic latitude satisfies nighttime and daytime requirements.}
    \label{fig:numstars}
\end{figure}

%-------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------------------------------
\section{DayStar Description}

\subsection{System Design}
As stated in the introduction, DayStar's goal is to see stars during the daytime with an accuracy of 1 arcsecond. The nighttime accuracy requirement is 0.1 arcseconds. In order to achieve this and improve upon the ST5000, the most important design parameter is sensitivity to red light. DayStar achieves a marked improvement by using a longpass filter at 620nm, as well as a scientific CMOS sensor that has strong near-infrared performance. The CIS2051 CMOS chip from Fairchild Imaging \cite{fairchild}, now BAE Systems, is implemented using a custom PCB, as seen in Figure \ref{fig:cmos}.
\begin{figure}[H]
    \includegraphics[width = 3.3in]{\rootdir cmos.jpg}
    \caption{A custom PCB was designed to interface with the CIS2051 and was assembled in house.}
    \label{fig:cmos}
\end{figure}
In addition to its red performance, the other advantages of the sCMOS sensor include its very low read noise and dark current, as well as a high pixel count (5.5 megapixels). The noise characteristics are less important for daytime, since background scattering dominates performance. However, at night, the lack of noise helps yield very crisp, high quality images. It should be noted that for this test flight, DayStar had power issues that generated excess read noise, resulting in grainy nighttime photos. Future improvements to the power system will be necessary to optimize performance.

The other advantage of the camera is that it contains many pixels, which helps spread out background light during daytime. The size of the pixels, 6.5$\mu$m, is also advantageous; combined with a long focal length, small pixels improve plate scale, which measures the number of arcseconds subtended by each pixel. The optical system for the test flight was an Olympus lens with a 150mm focal length. Modeling in the previous section takes into account these values in predicting system accuracy.
\begin{figure}[H]
    \centering
    \includegraphics[width=3 in]{\rootdir olympus.jpg}
    \caption{An Olympus 150mm, f2.0 camera lens was used for DayStar's test flight \protect\cite{olympus}.}
    \label{fig:olympus}
\end{figure}
The rest of the DayStar system is comprised of a baffle for the lens, a computer and a PCB for power distribution. The computer is a standard off-the-shelf motherboard with an Intel i3 processor. It consumes about 40W at 3.3V, 5V and 12V, which is all supplied by the power board, seen in Figure \ref{fig:power}. The power board also supports the camera, which requires seven power lines between -0.4V and 3.3V. In the flight configuration, all power is converted from a 15V lithium sulfur-dioxide battery, though DayStar may also run off a benchtop supply.
\begin{figure}[H]
    \includegraphics[width=3.3in]{\rootdir eps.jpg}
    \caption{The power board converts voltages for the entire payload.}
    \label{fig:power}
\end{figure}

%-------------------------------------------------------------------------------------------------------
\subsection{Flight and Concept of Operations}
On September 22nd, 2012 the DayStar system flew aboard the Wallops Arc Second Pointer (WASP) platform as a secondary payload, as shown in Figure \ref{fig:flight}. DayStar was mounted on the aft of the WASP platform such that when the WASP payload was under pointing control, DayStar was pointed near perpendicular to the sun and its field of view was centered 45 degrees above horizontal. The launch was conducted in Fort Sumner, NM as part of the CSBF 2012 campaign. The entire flight lasted about 15 hours starting at 8:30 am. DayStar actively operated for 5.5 hours, beginning operation 2.5 hours before astronomical sunset at 35km altitude and ending around 17:30 mountain standard time.
\begin{figure}
    \centering
    \includegraphics[width = 3.3in]{\rootdir daystar_flight.jpg}
    \caption{DayStar consisted of an optical and imaging segment, a computer and a battery mounted below the WASP telescope.}
    \label{fig:flight}
\end{figure}

Operation was split into three separate modes: daytime, twilight, and nighttime. During daytime and nighttime operation, bursts of images at a rate of 10Hz for durations of 20 and 50 seconds were taken respectively. These bursts were taken with varying gain and exposure times. During twilight operation 5 seconds bursts were taken and the camera settings were changed more rapidly to capture the effect of decreasing background brightness. In total, ~460 GB of images and health and status data were collected.

%-------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------------------------------
\section{Test Flight Results}

\subsection{Methodology}

Here we discuss the analysis methods we've been using. 

\subsubsection{Noise Reduction}

Discussion of subtraction and normalization methods. We should show a stock original image (nighttime) and a flatfielded version. Make sure to explain the mean and robust mean methods in detail.

\subsubsection{Star Identification and Matching}

Discussion of Kevin's star finding algorithm. Begin with centroiding methods and an image of a centroided star. Move on the the identification and matching between frames.

\subsubsection{Rotation Between Frames and Accuracy}

Conclude the section by describing how we find quaternions, what they represent, and how we use them to find our rotations and the precision of our estimates.

%-------------------------------------------------------------------------------------------------------
\subsection{Nighttime Results}

This section details nighttime results. Establish the images we are using: high-gain, what high-gain means (30x?), how many per burst, framerate, etc. Present a composite image of all matched stars along our best sequence. Present plots of the angular motion, both filtered and unfiltered. Report the precision.

%-------------------------------------------------------------------------------------------------------
\subsection{Daytime Results}

Unlike the nighttime images, daytime images were heavily affected by high sky background levels. This caused high-gain images to saturate, so only the low-gain images were usable. These images displayed much more column bias than their high-gain counterparts, making daytime analysis more difficult. 

Figure ??? shows a raw image taken during twilight. High levels of column noise are readily apparent. These were removed using the image normalization routine discussed in above. The result is shown in ???.


%-------------------------------------------------------------------------------------------------------
\subsection{Old Material}

\subsubsection{Analysis}
Before DayStar's test images could be analyzed for accuracy, they first had to be corrected for sensor biases and lens vignetting. This is referred to generically as flat-field correction \cite{flatfield}. 

The sCMOS sensor contains two independent sensor halves. Each half contains columns of pixels read out through different on-chip amplifiers, with both dark and exposed areas. To correct for varying biases in each amplifier, referred to commonly as \emph{fixed pattern noise} \cite{olympusmicro}, every dark column was compared to a composite robust mean of the entire dark area. This yielded a multiplication factor for each column, describing the difference between each column and the overall dark area. When applied, these factors normalize all column amplifiers as if a uniform amplification was applied everywhere. This process is repeated for the top and bottom sensor halves. Then a similar process, where the columns in each half were compared with a robust average of both halves. This normalizes gains between the two halves, and yields a full image, with uniform amplification. Typically, correcting for fixed pattern noise is done by subtracting dark frames from every readout frame. Due to readout speed requirements and camera design, this was not possible for the DayStar team. In addition, this process must be repeated for each image. CMOS temperature sensitivity and electrical fluctuations in the design cause gain factors to change, even over short image bursts. 


The analysis of DayStar's test flight data began by finding stars in the images collected. Stars were located in images by first estimating the image background using a robust median. Pixels and groups of pixels that surpassed this background median by a threshold were identified as potential stars. Once a potential star was identified, a region of interest in the image around a potential star was defined. The column noise inherent in a CMOS images was subtracted from the columns in the region of interest by subtracting the robust median (to 2 sigma) of each column from that column. If the potential star was large enough to be considered a star rather than noise, a more precise centroid for that star was computed using an intensity weighted center of gravity centroiding algorithm. A comparison of the three algorithms explored for this refined centroiding can be seen in Figure \ref{fig:centroidmethods}. 
\begin{figure}[H]
    \centering
    \includegraphics[width = 3.3in]{\rootdir centroidmethods.png}
    \caption{Comparison of weighted center of gravity (red), center of gravity (green), and Gaussian centroid methods on a typical star after region of interest column subtraction.}
    \label{fig:centroidmethods}
\end{figure}

After identifying the stars in each image and calculating a refined centroid for each star, a composite image showing the travel of star locations as the number of frames progressed in a burst was created. The image in Figure \ref{fig:starpaths} is a composite image showing circled star locations found in each image for a 500 image burst during nighttime operation. The streaks show clear travel of stars, primarily in the yaw axis.
\begin{figure}[H]
    \centering
    \includegraphics[width = 3.3in]{\rootdir starpaths.png}
    \caption{Star positions over a 500 image burst during nightime operation.}
    \label{fig:starpaths}
\end{figure}

It is also clear that star identification picked up false stars; this is seen in the column noise on the left hand side of Figure \ref{fig:starpaths}. The circled stars that did not streak as a function of frames may also be false noise stars or stars that were faint enough to only be detectable in a small number of frames. The number of stars detected is expected to stay near constant in one of these bursts because the WASP gondola was under pointing control to within one degree and DayStar has an 8.3 degree field of view. Figure \ref{fig:numstars} shows the number of stars detected in a 500 image burst.
\begin{figure}
    \centering
    \includegraphics[width = 3.3in]{\rootdir numstars.png}
    \caption{Number of stars detected over a 500 image burst during nightime operation.}
    \label{fig:numstars}
\end{figure}

With the stars identified in each frame identified, the next step was to correlate stars between frames. This was done by searching between one frame and the next for star locations within a search radius relative to the first frame. In Figure \ref{fig:matchstarpaths} and Figure \ref{fig:matchnumstars} the star locations of matched stars and the number of stars matched for the same 500 image burst are shown.  
\begin{figure}
    \centering
    \includegraphics[width = 3.3in]{\rootdir matchstarpaths.png}
    \caption{Matched star positions over a 500 image burst during nightime operation.}
    \label{fig:matchstarpaths}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width = 3.3in]{\rootdir matchnumstars.png}
    \caption{Number of matched stars detected over a 500 image burst during nightime operation.}
    \label{fig:matchnumstars}
\end{figure}

The number of stars matched between frames is lower than the number of stars detected. This makes sense because the false noise stars or fainter stars identified periodically are not correlated between frames. With star locations correlated between images, the next step was to calculate 3D projections of the optical frame and determine a quaternion rotation between frames.   

\subsubsection{Tracking Performance}
Before tracking algorithms can be run, DayStar's 2D centroids must be transformed into 3D vectors pointing from the DayStar sensor, down the optical boresight, to each star center. This transformation is computed by:
\begin{equation}
    \vec{R}_{star} = \frac{1}{\sqrt{f^2 + \Delta{x^2} + \Delta{y^2}}} \arrayb{c}{\Delta{x} \\ \Delta{y} \\ f}
\end{equation}
where $\Delta{x}$ and $\Delta{y}$ are the pixel offsets of the star centroid from the image origin, and $f$ is the focal length of DayStar's optics. A set of 3D unit vectors is generated for each star in every one of DayStar's images.

The matching star vectors between frames can be used to find the attitude rotation between each frame using the q-method. After this is done for an entire image burst, DayStar's attitude can be mapped over time relative to the attitude of the first image.

Even though DayStar's innertial attitude is unknown, the variability of relative attitude changes describes DayStar's tracking precision. However, this assumes that the WASP platform was totally stationary during the entirety of the burst. Because we know this is not true, we assume that the motion of the WASP gondola can mostly be characterized by low frequency modes, and that DayStar's attitude variabililty is at a much higher frequency. To isolate the two effects filtering was performed in the frequency domain. To perform the filtering, quaternion rotations were converted into the following Euler angles: yaw, pitch, and roll.

The angles were then transformed into the frequency domain, using Fast Fourier transforms. A high-pass filter was then applied to remove frequencies lower than 1.5 Hz. Transforming back into the time domain, the roll, pitch, and yaw vectors now represent the changes in an attitude solution, minus the slow movement of the balloon gondola itself.

Below are plots illustrating the filtering process for each Euler angle for a batch of nighttime images. Time-domain signals are on the leftmost subplots, and frequency-domain power spectrum plots are on the rightmost subplots, with original signals on top and filtered signals on the bottom.
\begin{figure*}
    \centering	
    \includegraphics[width=7.5in]{\rootdir yaw_1.5Hz_freq.png}
    \caption{Yaw Signal and Filtering Using FFT.}
    \label{fig:Yaw Filtering}
\end{figure*}
\begin{figure*}
    \centering
    \includegraphics[width=7.5in]{\rootdir pitch_1.5Hz_freq.png}
    \caption{Pitch Signal and Filtering Using FFT.}
    \label{fig:Pitch Filtering}
\end{figure*}
\begin{figure*}
    \centering
    \includegraphics[width=7.5in]{\rootdir roll_1.5Hz_freq.png}
    \caption{Roll Signal and Filtering Using FFT.}
    \label{fig:Roll Filtering}
\end{figure*}

It is apparent that low frequency oscillations are removed by the filtering process. The standard deviation of the norm of the roll, pitch, and yaw is:
\begin{displaymath}\large
    \boxed{\sigma_{RPY} = 2.4647 arcseconds}
\end{displaymath}

%-------------------------------------------------------------------------------------------------------
%-------------------------------------------------------------------------------------------------------
\section{Conclusions}
Through modeling, testing, and analysis, the DayStar team has shown that its design of a diurnal star tracker is valid. As a prototype unit on a test flight, DayStar was able to observe and centroid stars in daytime conditions, and provide accurate solutions at the nighttime.

DayStar's main goal at this point is to operate on another test flight within a year's time. Several design shortcomings were identified as the test flight neared. One main design issue was that the power system was contained in a single unit, far from the camera system. The imaging system has stringent power requirements to operate ideally, and the power design currently in place did not meet those requirements. An imaging board, with more power planes, better attention paid to power isolation, and all power regulation done on chip should provide cleaner images. Cleaner images will yield more accurate centroids, and more identifiable stars.

Another design change would be to add active thermal regulation to key components, specifically, the CMOS image sensor. In flight, the imaging system temperature stayed around 25C. Image noise increases drastically with temperature, and active cooling down to the sensor's optimal temperature range will help provide cleaner images for analysis.

Finally, the CONOPS used for flight needs to be changed. The imaging system has two gain settings: high and low. In night tests, the high gain settings were observed to be much cleaner than low, and stars were easier to identify from the background. In daytime, exposures were such that the high gain images were fully saturated. Only for a few exposure times were stars identifiable using the low gain images. By adjusting exposure times to ensure that the high gain images were correctly exposed for, improved star identification and tracking performance is expected.

DayStar expects that with the design and CONOPS changed implemented, future balloon flights would yield better performance in operation and star identification. Both the accuracy in tracking fields, as well as the number of stars observed in daytime and night time conditions will go up, further validating DayStar's capability as a diurnal star tracker.

%-------------------------------------------------------------------------------------------------------
\bibliographystyle{IEEEtran}
\bibliography{IEEEabrv,IEEE_paper}

%-------------------------------------------------------------------------------------------------------
\thebiography
\begin{biographywithpic}{Nick Truesdale}{\rootdir Nick.eps}
is a graduate student in Aerospace Engineering at the University of Colorado at Boulder.
He has been the Electrical Systems Lead for four balloon payloads, and has a wealth of experience designing power systems and embedded electronics. His other projects have included CubeSats with the University of Colorado and radar scattering simulation with MIT Lincoln Laboratory. Nick enjoys playing guitar and marimba as well as downhill skiing.
\end{biographywithpic}

\begin{biographywithpic} {Kevin Dinkel}{\rootdir Kevin.eps}
is a graduate student in Aerospace Engineering at the University of Colorado at Boulder. He has been involved in designing and flying 5 balloon payloads as Project Manager, CDH Lead Engineer, and Mission Specialist. Kevin is a skillful software engineer and currently works on planning and scheduling algorithms at the Laboratory for Atmospheric and Space Physics (LASP) for the MMS 4-spacecraft cluster.
\end{biographywithpic}

\begin{biographywithpic}{Zach Dischner}{\rootdir Zach.eps}
graduated with a BS in Aerospace Engineering in 2012 from the University of Colorado at Boulder. Currently, he is a graduate student pursuing a MS in Aerospace Engineering Systems. He is a graduate data systems technician for the Laboratory for Atmospheric and Space Physics (LASP). Zach is a fervent outdoorsman, whose main interests include skiing, kiteboarding, rock climbing, as well as freelance photography.
\end{biographywithpic}

\begin{biographywithpic}{Jed Diller}{\rootdir Jed.eps}
graduated with a B.S. in Aerospace Engineering from the University of Colorado at Boulder in 2012. His role on the DayStar project was primarily electrical engineering but this shifted during the flight readiness phase to include systems and test engineering as well as project management. His former professional work includes software engineering for geophysical software companies and the University Corporation for Atmospheric Research.
\end{biographywithpic}

\begin{biographywithpic}{Eliot F. Young}{\rootdir Eliot.eps}
Eliot F. Young received an A.B .in Physics from Amherst College in 1984, an S.M. in Aeronautical Engineering from M.I.T. in 1987, an S.M. in Earth, Atmospheric and Planetary Science (EAPS) from M.I.T. in 1990, and an Sc.D. from M.I.T. (EAPS) in 1992. He is currently a Principal Scientist at Southwest Research Institute in Boulder, CO, in the Department of Space Studies. His current areas of study include the surfaces and atmospheres of Pluto, Triton, Eris and other large Trans-Neptunian Objects, as well as the distributions of aerosols and trace gases in Titan's atmosphere and the wind fields on Venus. He has led observing campaigns on four continents.
\end{biographywithpic}

\acknowledgments
The authors would like to thank those from the Wallops Arc Second Pointer team and the Columbia Scientific Balloon Facility for their help in flying DayStar. Thanks also go to Dr. Kim Ennico, Dr. Scott Palo and Trudy Schwartz for their assistance and resources throughout the design process.

\end{document}